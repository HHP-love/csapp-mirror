name: Mirror CSAPP (Safe)

on:
  workflow_dispatch:

jobs:
  mirror:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Install tools
        run: sudo apt-get update && sudo apt-get install -y wget tar

      - name: Download CSAPP (polite mode)
        run: |
          wget \
            --recursive \
            --level=5 \
            --page-requisites \
            --html-extension \
            --convert-links \
            --no-parent \
            --wait=1 \
            --limit-rate=300k \
            --retry-connrefused \
            --tries=10 \
            --timeout=30 \
            http://csapp.cs.cmu.edu/

      - name: Archive
        run: tar -czf csapp-site.tar.gz csapp.cs.cmu.edu

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: csapp-site
          path: csapp-site.tar.gz
